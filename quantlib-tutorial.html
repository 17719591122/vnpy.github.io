<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <title>在Python中使用QuantLib</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">vn.py </a></h1>
                <nav><ul>
    
                        <li><a href="/pages/jiao-cheng.html">教程</a></li>
    
                        <li><a href="/pages/ri-zhi.html">日志</a></li>
                    <li class="active"><a href="/category/wen-zhang.html">文章</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/quantlib-tutorial.html" rel="bookmark"
           title="Permalink to 在Python中使用QuantLib">在Python中使用QuantLib</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>2016-03-15(周二)</span>

</footer><!-- /.post-info -->      <h2>Quantlib简介</h2>
<p>相比TA-Lib在技术分析领域的地位，QuantLib在金融工程领域的地位可以说有过之而无不及。</p>
<p>参考其<a href="http://quantlib.org/reference/modules.html">官方网站</a>，QuantLib中包含的的模块如下（其中个人感觉国内比较有用的添加了中文注释）：</p>
<blockquote>
<ul>
<li>
<p>Currencies and FX rates（货币相关）</p>
</li>
<li>
<p>Date and time calculations（日期和时间计算）</p>
</li>
<li>
<p>Calendars  </p>
</li>
<li>
<p>Day counters   </p>
</li>
<li>
<p>Design patterns  </p>
</li>
<li>
<p>Financial instruments</p>
</li>
<li>
<p>Finite-differences framework</p>
</li>
<li>
<p>Lattice methods  </p>
</li>
<li>
<p>Math tools</p>
</li>
<li>
<p>1-D Interpolations and corresponding traits    </p>
</li>
<li>
<p>One-dimensional solvers    </p>
</li>
<li>
<p>Optimizers（优化器）</p>
</li>
<li>
<p>Monte Carlo framework    （蒙特卡洛模拟框架）</p>
</li>
<li>
<p>Numeric types    </p>
</li>
<li>
<p>Output manipulators  </p>
</li>
<li>
<p>Pricing engines（定价引擎）</p>
</li>
<li>
<p>Asian option engines（亚式期权）</p>
</li>
<li>
<p>Barrier option engines（障碍期权）</p>
</li>
<li>
<p>Basket option engines（篮子期权）</p>
</li>
<li>
<p>Cap/floor engines  </p>
</li>
<li>
<p>Cliquet option engines </p>
</li>
<li>
<p>Forward option engines（远期期权）</p>
</li>
<li>
<p>Quanto option engines  </p>
</li>
<li>
<p>Swaption engines   </p>
</li>
<li>
<p>Vanilla option engines（普通期权）</p>
</li>
<li>
<p>QuantLib macros  </p>
</li>
<li>
<p>Debugging macros   </p>
</li>
<li>
<p>Numeric limits </p>
</li>
<li>
<p>Short-rate modelling framework（短期利率建模框架）</p>
</li>
<li>
<p>Stochastic processes（随机过程）</p>
</li>
<li>
<p>Term structures（期限结构）</p>
</li>
<li>
<p>Utilities</p>
</li>
</ul>
</blockquote>
<p>作为期权交易员，作者本人比较关注的是期权定价引擎和日历模块。接下来国内预计将会推出的大商所豆粕期权和郑商所白糖期权都是美式期权，在每天连续交易时段中定价比较适合的是二叉树模型。相比较于闭式解的BS模型，基于数值模拟的二叉树模型的运算量提高了一个数量级，因此高效的定价引擎对于这些商品期权的交易员而言十分重要。QuantLib使用C++开发，并通过SWIG包装对其他语言提供调用API，足以满足连续交易对性能的需求。</p>
<p>其他的亚式期权、障碍期权定价引擎等，则适合国内OTC期权市场的参与者（无论做市商还是买方机构），毕竟这是一个“货物出柜、概不退换”的市场，想要不被对手坑就得保证自己也能有奇异期权定价能力。</p>
<h2>QuantLib在Python中的安装</h2>
<p>QuantLib功能强大的同时安装也较为复杂，其官方网站仅提供了源代码，需要用户自行编译，完成后还需要编译QuantLib的SWIG封装从而实现Python调用。</p>
<p>除了官方提供的SWIG封装外，Enthought公司在Github上还有一个名为pyql的Cython封装项目，号称速度更快，API设计更Pythonic，但是这里作者提醒：</p>
<blockquote>
<blockquote>
<p>除非真的特别喜好折腾，否则轻易不要跳pyql的坑！安装过程相当复杂（涉及到修改QuantLib的C++源代码），pyql在github上的安装教程中的步骤也有一些错误，作者跳坑后花了两周都没爬出来，老老实实回去用SWIG封装了。</p>
</blockquote>
</blockquote>
<p>下面开始一步步的介绍安装步骤：</p>
<ol>
<li>
<p>参考<a href="http://vnpy.org/2015/03/12/20150312_Python%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93%E5%B9%B3%E5%8F%B0%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B%E7%B3%BB%E5%88%973-vn.py%E9%A1%B9%E7%9B%AE%E4%B8%ADAPI%E5%B0%81%E8%A3%85%E7%9A%84%E7%BC%96%E8%AF%91/">Python量化交易平台开发教程系列3-vn.py项目中API封装的编译</a>中的步骤，安装好Anaconda、Visual Studio和Boost，假设Anaconda的安装路径为<strong>D:\Anaconda</strong>，Boost的安装路径为<strong>D:\boost_1_60_0</strong>。</p>
</li>
<li>
<p>在<a href="https://sourceforge.net/projects/quantlib/files/QuantLib/">这里</a>下载QuantLib和Quantlib-SWIG，注意请选择两者都有的版本（在作者写这篇教程时，两者都有的最新版本号是1.7），将下载的zip文件分别解压缩，假设路径为<strong>D:\QuantLib-1.7</strong>和<strong>D:\QuantLib-SWIG-1.7</strong>。</p>
</li>
<li>
<p>在<a href="http://www.swig.org/">这里</a>下载SWIG（swigwin-3.0.8），并解压缩放到<strong>D:\swigwin-3.0.8</strong>。</p>
</li>
<li>
<p>设置以下环境变量（不会的请参考<a href="http://jingyan.baidu.com/article/3ea51489e1c2b752e61bbad0.html">设置环境变量</a>）：</p>
</li>
<li>
<p>QL_DIR：D:\QuantLib-1.7</p>
</li>
<li>myanaconda：D:\Anaconda</li>
<li>myboost：D:\boost_1_60_0</li>
<li>myswig：D:\swigwin-3.0.8</li>
<li>
<p>myqlswig：D:\QuantLib-SWIG-1.7</p>
</li>
<li>
<p>编译安装QuantLib，打开cmd，切换到D盘（输入D:，因为上面的所有文件夹都在D盘），点击窗口左上角的图标，选择“编辑-&gt;粘贴“，将下方的批处理命令复制到cmd中运行（可以一次性全部复制，也可以逐行复制运行，注意全部复制时，若运行到某一步卡住，可以尝试按回车执行这一步的命令）：</p>
<div class="highlight"><pre>REM 这里使用的是VS2013

REM 打开VS命令行工具来设置编译所需的环境变量
<span class="s2">&quot;%VS120COMNTOOLS%\VsDevCmd.bat&quot;</span>

REM 切换到QuantLib代码所在的文件夹
<span class="nb">cd</span> %QL_DIR%

REM 把boost库添加到include和library路径中，并且指定VSC+<span class="o">=</span>使用这些路径
<span class="nb">set </span><span class="nv">INCLUDE</span><span class="o">=</span>%myboost%;%INCLUDE%
<span class="nb">set </span><span class="nv">LIB</span><span class="o">=</span>%myboost%<span class="se">\l</span>ib32-msvc-12.0;%LIB%
<span class="nb">set </span><span class="nv">UseEnv</span><span class="o">=</span><span class="nb">true</span>

REM 使用msbuild来编译QuantLib
REM 这个要花一段时间（几十分钟到若干小时）
msbuild /p:AdditionalLibPaths<span class="o">=</span><span class="s2">&quot;%myboost\lib&quot;</span> /p:Configuration<span class="o">=</span>Release /p:Platform<span class="o">=</span>Win32 QuantLib_vc12.sln
</pre></div>


</li>
<li>
<p>编译安装QuantLib-SWIG，将下方的批处理命令复制到cmd中运行（运行方法和上一步相同）：</p>
<div class="highlight"><pre><span class="nb">set </span><span class="nv">VS100COMNTOOLS</span><span class="o">=</span>%VS120COMNTOOLS%

REM 打开VS命令行工具来设置编译所需的环境变量
<span class="s2">&quot;%VS120COMNTOOLS%\VsDevCmd.bat&quot;</span>

REM 切换到QuantLib-SWIG下面的Python文件夹下
<span class="nb">cd</span> %myqlswig%<span class="se">\P</span>ython

REM 创建setup.cfg
<span class="nb">echo</span> <span class="o">[</span>build<span class="o">]</span> &gt; setup.cfg
<span class="nb">echo </span><span class="nv">compiler</span><span class="o">=</span>msvc &gt;&gt; setup.cfg

REM 设置路径和环境变量
<span class="nb">set </span><span class="nv">PATH</span><span class="o">=</span>%myanaconda%;%myanaconda%<span class="se">\s</span>cripts;%myswig%;%PATH%
<span class="nb">set </span><span class="nv">INCLUDE</span><span class="o">=</span>%myboost%;%INCLUDE%
<span class="nb">set </span><span class="nv">LIB</span><span class="o">=</span>%myboost%<span class="se">\l</span>ib32-msvc-12.0;%LIB%

REM 编译QuantLib-SWIG的Python接口
REM 只有当swig的.i文件发生变化时，才需要先执行wrap命令
python setup.py wrap
python setup.py build
python setup.py install
</pre></div>


</li>
<li>
<p>接下来可以尝试运行<strong>D:\QuantLib-SWIG-1.7\Python\examples</strong>目录下的一些例子，没有报错则说明安装成功</p>
</li>
</ol>
<h2>vn.py和QuantLib</h2>
<p>相比较于TA-Lib，QuantLib由于其主要针对复杂衍生品，适用的人群会相对窄一些，举两个例子：</p>
<p><strong>商品期权的CTA策略交易</strong></p>
<p>前文已经提到过国内的商品期权将会主要采用美式期权的合约设计，在定价方面需要使用二叉树模型。商品期权的最小价格变动通常比其标的物本身更小（相同的价格变动对应的TICK跳动更多），所以会比其标的物更适合交易CTA类的策略。</p>
<p>但是同时因为期权的非线性特征，在做多时可以采用买入看涨和卖出看跌两种方法（做空也一样有两种：买入看跌和卖出看涨），具体的选择就需要参考当时的波动率水平，而QuantLib的速度足以满足CTA类策略对于低延时的要求。</p>
<p><strong>场外期权交易系统</strong></p>
<p>越来越多的国内买方机构（券商资管、信托、基金和私募等）开始参与到OTC期权的市场，OTC期权以灵活著称，不但可交易的品种更多（沪深300、中证500、黄金、铜等），可供选择的期权类型也更多（灵活到期时间、奇异期权）。</p>
<p>目前大部分机构依旧采用传统的EXCEL来记录和管理，通常需要手动输入行情数据（也可以使用Wind接口接入实时行情），使用较为麻烦也无法做到实时的一些交易对冲。同时由于EXCEL VBA的局限性，对于障碍期权等奇异期权，买家往往无法自己进行估值，必须依赖于OTC做市商给出的数字。</p>
<p>结合vn.py和QuantLib，交易员可以构建连通场内外的期权交易系统，使用数据库而不是EXCEL来管理持仓和风险，并基于实时行情来计算当前持仓的希腊值敞口，结合场内的期货和现货（ETF、股票等）来实现日内对冲，从而真正实现三维立体的交易模式。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://python.org/">Python.org</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="http://github.com/vnpy/vnpy">Github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

</body>
</html>